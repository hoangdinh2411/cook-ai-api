services:
    - type: web
      name: cook-ai-api
      env: docker
      plan: free
      region: frankfurt
      dockerfilePath: ./Dockerfile
      autoDeploy: true
      healthCheckPath: /healthz
      envVars:
          - key: OPENAI_API_KEY
            sync: false
          - key: OPENAI_VISION_MODEL
            value: gpt-4o-mini
          - key: OPENAI_RECIPES_MODEL
            value: gpt-4o-mini
          - key: RECIPES_CACHE_TTL
            value: '86400'
          - key: VISION_CACHE_TTL
            value: '86400'
          - key: MAX_IMAGE_BYTES
            value: '3000000'
          - key: API_URL
            value: 'https://fastapi-recipes.onrender.com'
          # Link Redis URL from the Redis service below (remove the manual REDIS_URL above)
          - key: REDIS_URL
            fromService:
                type: redis
                name: cook-ai-redis
                property: connectionString

    - type: redis
      name: cook-ai-redis
      region: frankfurt
      plan: free
      ipAllowList: []
      maxmemoryPolicy: noeviction
